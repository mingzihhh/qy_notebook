## CDN

基本原理是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中，在用户访问网站时，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上，由缓存服务器直接响应用户请求。

**内容分发网络(CDN)**是一个经策略性部署的整体系统，包括分布式存储、负载均衡、网络请求的重定向和内容管理4个要件。

- 内容发布：它借助于建立索引、缓存、流分裂、组播（Multicast）等技术，将内容发布或投递到距离用户最近的远程服务点（POP）处；

- 内容路由：它是整体性的网络负载均衡技术，通过内容路由器中的重定向（DNS）机制，在多个远程POP上均衡用户的请求，以使用户请求得到最近内容源的响应；

- 内容交换：它根据内容的可用性、服务器的可用性以及用户的背景，在POP的缓存服务器上，利用应用层交换、流分裂、重定向（ICP、WCCP）等技术，智能地平衡负载流量；

- 性能管理：它通过内部和外部监控系统，获取网络部件的状况信息，测量内容发布的端到端性能（如包丢失、延时、平均带宽、启动时间、帧速率等），保证网络处于最佳的运行状态。

  

**实现原理：**

在用户和服务器之间增加cache层，通过接管DNS,将用户的请求引导到cache上获得服务器的资源。



**CDN缓存策略**  --  决定CDN服务器什么时候去更新自己的资源。

`Cache-Control`的`max-age`头可以告知文件在浏览器的缓存时间，在`max-age`指定的时间内，浏览器会直接使用本地缓存，而不会请求服务器。

CDN采取了类似的机制，你只要把CDN节点看成浏览器，源服务器看成浏览器需要请求的服务器即可，此时，源服务器的`max-age`头决定了资源在CDN节点本地缓存的时间，有一点差别的是，CDN规定了一个自定义协议，也就是上文说的`s-maxage`，若源站该`s-maxage`存在，会优先使用`s-maxage`作为CDN的缓存时间。



![](https://jayzangwill.github.io/blog/img/cache/cdn_step.png)






