## 代码优化

#### 减少HTTP请求

1. 合并JavaScript、合并css成一个文件，打包压缩代码

2. 合并图片到一个图片（雪碧图）

3. 合理设置http缓存

   

#### 图片优化

1. 根据业务场景，与UI探讨选择 **合适质量，合适尺寸**；

2. 根据需求和平台，选择 **合适格式**
   - 对于能够显示 WebP 格式的浏览器尽量使用 WebP 格式。因为 WebP 格式具有更好的图像数据压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量，缺点就是兼容性并不好，ios不兼容
   - 小图使用 PNG，其实对于大部分图标这类图片，完全可以使用 SVG 代替
   - 大的照片/背景图/banner图使用 JPEG

3. 小图片合成 **雪碧图**，低于 5K 的图片可以转换成 **base64** 内嵌；

4. 合适场景下，使用 **iconfont** 或者 **svg**；
5. 不用图片。很多时候会使用到很多修饰类图片，其实这类修饰图片完全可以用 CSS 去代替。
6. 对于移动端来说，屏幕宽度就那么点，完全没有必要去加载原图浪费带宽。一般图片都用 CDN 加载，可以计算出适配屏幕的宽度，然后去请求相应裁剪好的图片。



#### 优化高频事件

1. 防抖节流
2. 增加响应变化的时间间隔
3. 使用 requestAnimationFrame 监听帧变化



#### 无阻塞加载

1. css 文件`<head>`中 link 引入， js 文件`<body>`底部使用异步加载

2. 影响首屏的，优先级很高的 js 也可以头部引入，甚至内联；

   

#### 代码优化

##### dom优化

- **减少访问 dom 的次数**，如需多次，将 dom 缓存于变量中；

- **减少重绘与回流**: 

  - 多次操作合并为一次；

  - 减少对计算属性的访问； 

    - 例如 offsetTop， getComputedStyle 等

    - 因为浏览器需要获取最新准确的值，因此必须立即进行重排，这样会破坏了浏览器的队列整合，尽量将值进行缓存使用；

  - 大量操作时，可将 dom 脱离文档流或者隐藏，待操作完成后再重新恢复；

  - 使用`DocumentFragment / cloneNode / replaceChild`进行操作；

- 使用事件委托，避免大量的事件绑定；

- 使用 DOMFragment 缓存批量化 DOM操作




##### css优化

- **层级扁平**，避免过于多层级的选择器嵌套；

- **特定的选择器** 好过一层一层查找:  .xxx-child-text{} 优于 .xxx .child .text{}

- **减少使用通配符与属性选择器**；

- **减少不必要的多余属性**；

- 使用 **动画属性** 实现动画，动画时脱离文档流，开启硬件加速，优先使用 css 动画；

- 使用 `<link>` 替代原生 @import；

  

##### html 优化

- **减少 dom 数量**，避免不必要的节点或嵌套；

- 避免`<img src="" />`空标签，能减少服务器压力，因为 src 为空时，浏览器仍然会发起请求 
  - IE 向页面所在的目录发送请求；
  - Safari、Chrome、Firefox 向页面本身发送请求；
  - Opera 不执行任何操作。
  
- 图片提前 **指定宽高** 或者 **脱离文档流**，能有效减少因图片加载导致的页面回流；

- **语义化标签** 有利于 SEO 与浏览器的解析时间；

- 减少使用 table 进行布局，避免使用`<br />`与`<hr />`；

  

##### js优化

- **数据读取**:

  - 通过作用域链 / 原型链 读取变量或方法时，需要更多的耗时，且越长越慢；

  - 对象嵌套越深，读取值也越慢；

  - 最佳实践：

    - 尽量在局部作用域中进行 **变量缓存**；

    - 避免嵌套过深的数据结构，**数据扁平化** 有利于数据的读取和维护；

- **循环**: 循环通常是编码性能的关键点；

  - 代码的性能问题会再循环中被指数倍放大；

  - 最佳实践: 

    - 尽可能减少循环次数

      - 减少遍历的数据量；

      - 完成目的后马上结束循环；

    - 避免在循环中执行大量的运算，避免重复计算，相同的执行结果应该使用缓存；
    - js 中使用 **倒序循环** 会略微提升性能；
    - 尽量避免使用 for-in 循环，因为它会枚举原型对象，耗时大于普通循环；

- **条件流程性能**: Map / Object > switch > if-else









