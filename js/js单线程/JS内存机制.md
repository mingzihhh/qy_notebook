## JS内存机制

<https://juejin.im/post/5b1deac06fb9a01e643e2a95>

在JS中，每一个数据都需要一个内存空间。内存空间又被分为两种，**栈内存(stack)与堆内存(heap)**。

栈：

- 存储基础数据类型和引用，调用函数
- 按值访问
- 存储的值大小固定
- 由系统自动分配内存空间
- 空间小，运行效率高
- 先进后出，后进先出
- 栈中的DOM，ajax，setTimeout会依次进入到队列中,当栈中代码执行完毕后，再将队列中的事件放到执行栈中依次执行。
- 微任务和宏任务

堆:

- 存储引用数据类型
- 按引用访问
- 存储的值大小不定，可动态调整
- 主要用来存放对象
- 空间大，但是运行效率相对较低
- 无序存储，可根据引用直接获取



#### 栈内存一般储存基础数据类型

string，number，bollean，null，undefined，symble

```
var a = 1 
```

我们定义一个变量a，系统自动分配存储空间。我们可以直接操作保存在栈内存空间的值，因此基础数据类型都是**按值访问**。

数据在栈内存中的存储与使用方式类似于数据结构中的堆栈数据结构，遵循**先进后出**的原则。



#### 堆内存一般储存引用数据类型的值

```
var b = { xi : 20 }
```

与其他语言不同，JS的引用数据类型，比如数组Array，它们值的大小是不固定的。引用数据类型的值是保存在堆内存中的对象。JavaScript**不允许直接访问堆内存中的位置**，因此我们不能直接操作对象的堆内存空间。

当我们要访问堆内存中的引用数据类型时，实际上我们首先是**从栈中获取了该对象的地址引用（或者地址指针）**，然后再从堆内存中取得我们需要的数据。

![](https://user-gold-cdn.xitu.io/2018/6/13/163f6b03478ae38a?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)



**对象**放在**heap（堆）里，常见的基础类型放在stack（栈）里，函数执行的时候在栈**里执行。

**栈里的代码先行执行**，再从队列中依次读事件，加入栈中执行 =>事件循环

![](https://user-gold-cdn.xitu.io/2018/6/13/163f6b033cff7849?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)