**基本工作：**

1. 收集系统日志：slardar 平台

- 用户使用情况：UV，PV，页面各模块曝光，用户交互行为，用户标志，页面地址参数...

- 系统在用户端运行情况

  - 性能日志：FP，FCP，LCP，TTI..
  - 异常日志：JS Error，资源加载错误，白屏错误

- 系统依赖服务的运行情况

  - API 日志：调用日志，API 请求错误（系统错误，业务错误，网关返回错误..
  - 网络和服务器日志： cdn 日志
  - APP 内 webview 容器日志：性能，Error
  - JSB 调用日志：调用，JSB 错误

  

2. 了解系统现状和制定稳定性目标

- 选取指标
  - 用户使用指标：UV，PV，页面曝光，重要交互记录
  - 系统在用户端运行状态：FP，FCP，JS 错误率，静态资源错误影响率，CDN 加载失败率
  - 系统依赖服务的运行状态：API 调用量，API 耗时，JSB 错误率，webview 错误率，cdn 错误率，网络不可达错误率
  - 特殊业务场景看板：下单数为 0 ...
- 建立指标看板：
  - 量化：设定时间窗口，最高值，最低值，波动百分比
  - 合理的分组变量（页面路径，页面来源，apiPath 等），增强指标变化的不确定性
  - 根据用户访问量调整稳定性目标：访问量较大 => 成功率，错误率，访问量较小 => 访问量，错误量
- 制定目标
  - 在统计时间窗口为 10 分钟情况下，UV 同比 t-1 波动不超过 x%，对于某页面 p1, UV 最大值 < x, 最小值 > y
  - 订阅看板，每天固定时间发送到团队群



3. 建立报警规则和值班机制

- 重要指标看板
- 指标订阅通知
- 异常报警



4. 优化稳定性现状

- 错误或性能治理
- 异常场景页面降级
  - 页面展示降级：
    - loading：loading 动画，骨架屏
    - error：具体错误提示样式
  - 交互行为降级
- 报警值班和响应处理
  - 值班 sop
  - 建立与 server 同学统一沟通的报警值班群



## 前端服务告警

**统一错误上报方式，通过分类分级快速定位前端问题，并减少噪音**

| **类型**                                               | **说明**                                                     | **是否自动上报** |
| ------------------------------------------------------ | ------------------------------------------------------------ | ---------------- |
| 白屏监控                                               | React 实例化之前发生的 error                                 | 是               |
| JS 错误                                                | 普通代码报错                                                 | 是               |
| JSON.parse、localstorage 溢出等可 try-catch 的 js 错误 | 否                                                           |                  |
| Error Boundary 捕获的严重问题                          | 否                                                           |                  |
| 资源加载失败                                           | 图片、视频、js、css 等资源加载失败时上报                     | 是               |
| http 请求                                              | api 请求的成功率、耗时                                       | 是               |
| JSB 错误                                               | JSB 执行的成功率、耗时（移动端）                             | 否               |
| 性能打点                                               | FCP、LCP、TTI、LOAD、CDN 耗时                                | 是               |
| 页面 FMP、首页渲染依赖的 api 总耗时                    | 否                                                           |                  |
| 基础业务指标                                           | UV、PV、API调用量                                            | 是               |
| 业务报错                                               | 核心接口数据返回错误，例如渲染依赖的数据应该是 list，却返回空；路由跳转以来后端数据返回，但无返回 -- P0一些数值展示类的数据返回错误，例如 bonus 配置 -- P1... 其他业务侧关心的错误信息 | 否               |
| 其他信息打点                                           | 异常弹窗/页面展现（资质审核等）异常 Toast 展现列表空搜 -- P1... 其他关心的信息 | 否               |

### **错误分类**

- JSBError
  - For 达人侧，JSB 所有的错误
- NetworkError 
  - 网络问题引起的错误，如 DNS，表明该请求并没有被正常打到服务端
- ServerError
  - 网络正常，但是服务返回了错误码， status_code !== success
- ResouceError
  - 图片/视频/脚本等资源加载错误
- RuntimeError
  - 语法错误（SyntaxError）
  - 类型错误（TypeError）
  - 范围错误（RangeError）
  - 引用错误（ReferenceError）
- UnknownError
  - 其他所有未知错误，异步 promise 产生的错误等 `window.onunhandledrejection`

### **前端监控指标**

| **Type**             | **Indictor**                             |
| -------------------- | ---------------------------------------- |
| **JS Error**         | 错误率                                   |
|                      | 影响用户率                               |
|                      | 新增 error 数                            |
| **JSB** **Error**    | 错误率                                   |
|                      | 影响用户率                               |
|                      | 新增 error 数                            |
| **White screen**     | 白屏数                                   |
|                      | 白屏错误率 & 影响用户率                  |
| **Static resources** | 平均下载速度、时间                       |
|                      | Img 错误率 & 影响用户率                  |
|                      | Video 错误率 & 影响用户率                |
|                      | Script 错误率 & 影响用户率               |
|                      | Link 错误率 & 影响用户率                 |
| **Interfaces**       | 请求失败率 4** / request failed rate 4** |
|                      | 请求失败率 5** / request failed rate 4** |
|                      | 慢请求                                   |

### 运行时异常

> 用户端上发生的异常

| **指标**     | **描述**                                                     | **实现方式**                                                 | **参考文档**                                                 |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| `jsError`    | 运行时 JS 报错，比如 `TypeError`                             | Slardar 自动上报封装异常捕获组件，手动上报（达人侧实现方式） |                                                              |
| `imgError`   | 图片加载异常                                                 | 封装统一的 `Image` 组件                                      |                                                              |
| `apiError`   | 包含以下情况：HTTP `status` 非 2xx业务 `code` 非 `0`JSB 错误 | 业务请求，对 `axios` 做统一的拦截处理前端代理 JSB 调用，捕获错误 |                                                              |
| `blankError` | 包含以下情况：页面真的白屏前端展示异常兜底页面               | 依赖 Slardar 上报白屏前端展示异异常兜底页面时主动上报        | [如何监控 Web 页面白屏异常](https://bytedance.feishu.cn/wiki/wikcn52rZwqlxfhGYrck5f2VO4g) [白屏监控](https://bytedance.feishu.cn/wiki/wikcnm0mtGvR0aH8m7J8XvrndLf) |

### 网站性能

| **指标**           | **描述**                                                  | **实现方式**                                                 | **参考文档** |
| ------------------ | --------------------------------------------------------- | ------------------------------------------------------------ | ------------ |
| **页面渲染**       |                                                           |                                                              |              |
| `containerInit`    | 容器初始化时间（端内需要）                                | Spark 容器可以通过 `window.__globalProps?.initTimestamp`当前在用容器需要确认下是否有办法获取该数据 |              |
| `htmlFetch`        | HTML 加载耗时（这里不是首字节，而是最后一个字节接收完毕） | 通过 `window.performance?.timing?.responseEnd`               |              |
| `pageEnter`        | 页面进入时间打点                                          | 通过 `router` 钩子实现                                       |              |
| `dataFetchStart`   | 请求依赖数据开始打点，比如通过接口获取数据                | 封装 `Page` 组件，在组件内统一处理                           |              |
| `dataFetchEnd`     | 请求依赖数据结束打点                                      | 封装 `Page` 组件，在组件内统一处理                           |              |
| `pageVisible`      | 页面内容展示打点                                          | 通常是 loading 结束的时候，看是否可以抽离到 `Page` 组件      |              |
| `firstPageVisible` | 首屏内容展示打点，主要针对入口页面的打点                  | 通常是 loading 结束的时候，看是否可以抽离到 `Page` 组件      |              |
| **接口耗时**       |                                                           |                                                              |              |
| `apiFetch`         | 包含以下接口：业务接口JSB                                 | 业务请求，对 `axios` 做统一的拦截处理前端代理 JSB 调用，统一拦截处理 |              |

### 用户行为

| **指标**       | **描述** | **实现方式**                       | **参考文档** |
| -------------- | -------- | ---------------------------------- | ------------ |
| `pv`           |          |                                    |              |
| `uv`           |          |                                    |              |
| `pageDuration` | 停留时长 | 封装 `Page` 组件，在组件内统一处理 |              |



**核心转化链路监控（发单/接单）**

- 页面 uv/pv
- 核心接口监控（错误/成功）