Workspace 是指在一个代码库中管理多个相关项目或模块的能力。



#### 包管理工具通过以下方式实现 workspace 的支持：

1. 代码结构组织：在 Monorepo 中，不同的项目或模块通常位于同一个代码库的不同目录中。包管理工具通过识别并管理这些目录结构，可以将它们作为独立的项目或模块进行操作。
2. 共享依赖：Monorepo 中的不同项目或模块可以共享相同的依赖项。包管理工具可以通过在根目录中维护一个共享的依赖项列表，以确保这些依赖项在所有项目或模块中都可用。
3. 交叉引用：在 Monorepo 中，不同项目或模块之间可能存在相互引用的情况。包管理工具需要处理这些交叉引用，以确保正确解析和构建项目之间的依赖关系。
4. 版本管理：Monorepo 中的不同项目或模块可能具有不同的版本。包管理工具需要能够管理和跟踪这些版本，并确保正确地安装和使用适当的版本。
5. 构建和测试：包管理工具需要支持在 Monorepo 中进行增量构建和测试。这意味着只有发生更改的项目或模块会重新构建和测试，而不需要重新构建和测试整个代码库。



前端目前最主流的三款包管理工具 npm7+、yarn、pnpm 都已经原生支持 workspace 模式，但pnpm 很好的解决了 npm 与 yarn 遗留的历史问题。



#### npm 与 yarn 的历史遗留问题

- 扁平化依赖算法复杂，需要消耗较多的性能，**依赖串行安装**还有提速空间。
- 大量文件需要重复下载，对磁盘空间的利用率不足。（虽然在同一个项目中我不会重复的安装依赖 d 了，但是如果我有100个项目，100个项目都需要用到某个包，那么这个包依然会被下载100次，也就是在磁盘的不同地方写入100次）
- 扁平化依赖虽然解决了不少问题，但是随即带来了**依赖非法访问**的问题，项目代码在某些情况下可以在代码中使用**没有被定义在 package.json 中的包**，这种情况就是我们常说的**幽灵依赖**。



#### **pnpm 是如何解决上述问题的**

- **安装依赖提速**

  - 依赖安装的流程：
    - resolving：解析依赖树，决定要下载哪些安装包。
    - fetching：下载依赖的star包。这个阶段可以同时下载多个，来增加速度。
    - writing：解压包，根据文件构建出真正的依赖树，这个阶段需要大量文件IO操作
  - pnpm 针对每个包的三个流程都是**平行**的，所以速度会快很多。当然pnpm会多一个阶段，就是通过链接组织起真正的依赖树目录结构。

- ##### **使用硬连接的方式节约磁盘空间利用率、采用虚拟存储目录+软连接解决幽灵依赖**