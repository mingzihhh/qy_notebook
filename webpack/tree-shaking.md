Tree Shaking 是一种在编译阶段去除未使用代码的技术。Tree Shaking 能够分析代码的依赖关系树，找出那些没有被引用的代码并将其从最终的打包文件中剔除，从而减小代码体积，加快应用的加载速度。



### 原理基础

实现基础是 **ES6 模块系统的静态特性**。与 CommonJS 等动态模块加载系统不同，ES6 模块在编译时就能够确定模块之间的依赖关系。



### 工作流程

- **构建依赖关系树**：在项目构建过程中，构建工具（如 Webpack）会首先解析所有的模块文件，构建出一个完整的依赖关系树。每个模块作为树中的一个节点，模块之间的导入和导出关系则构成了树的边。
- **标记未使用代码**：基于构建好的依赖关系树，构建工具会从入口文件开始，递归地标记所有被使用到的模块和代码块。那些未被标记的代码则被视为未使用代码。
- **代码剔除**：构建工具会根据标记结果，将未使用的代码从最终的打包文件中剔除。这一步骤会对代码进行优化和压缩，生成一个体积更小、只包含实际使用代码的文件。



### 局限性

- **可能无法有效处理动态导入的代码**：例如如果 import() 的路径是动态计算的，在编译时无法确定具体导入的模块，构建工具通常会保守地将所有可能的模块都打包进最终的产物中，避免运行时错误。
- **有副作用的模块可能不会被剔除**：有些模块可能会产生副作用，即模块中的代码不仅仅是提供可导出的功能，还会在导入时执行一些其他操作，如修改全局变量、注册事件监听器等。如果一个模块存在副作用，构建工具在进行 Tree Shaking 时可能会过于保守，不会剔除该模块，即使其中部分代码未被使用。